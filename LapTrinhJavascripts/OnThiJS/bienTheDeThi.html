<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<style>
    table, th, tr, td {
        border: 2px solid green;
        border-collapse: collapse;
        text-align: center;
    }

    th {
        background-color: lightgray;
    }

    #tongSoTien {
        display: none;
    }

    #thanhToan {
        display: none;
    }
</style>
<body>
    <h3>Họ và tên: Nguyễn Đình Tú</h3>
    <h3>Mã số: PD11491</h3>
    <h1>Danh mục hàng hoá</h1>
    <table border="1">
        <tr>
            <th>Số thứ tự</th>
            <th>Tên sản phẩm</th>
            <th>Giá sản phẩm</th>
            <th>Thêm</th>
        </tr>
        <tr>
            <td class="stt">1</td>
            <td>Quần áo</td>
            <td class="dongia">210,000</td>
            <td><button onclick="them(this)">+</button></td>
        </tr>
        <tr>
            <td class="stt">2</td>
            <td>Giày dép</td>
            <td class="dongia">300,000</td>
            <td><button onclick="them(this)">+</button></td>
        </tr>
        <tr>
            <td class="stt">3</td>
            <td>Mắt kính</td>
            <td class="dongia">400,000</td>
            <td><button onclick="them(this)">+</button></td>
        </tr>
        <tr>
            <td class="stt">4</td>
            <td>Quần xì</td>
            <td class="dongia">50,000</td>
            <td><button onclick="them(this)">+</button></td>
        </tr>
    </table>
    <br><br>
    <h1>Giỏ hàng của bạn</h1>

    <table id="gioHang"></table>

    <h2 id="tongSoTien">Tổng số tiền</h2>

    <button onclick="tinhTien()" id="thanhToan">Thanh toán ngay</button>

    <script>
        var gioHang = document.getElementById("gioHang");
        var tongSoTien = document.getElementById("tongSoTien");
        var thanhToan = document.getElementById("thanhToan");

        function them(obj) {
            var tenSP = obj.parentNode.parentNode.children[1].innerText;
            var giaSP = obj.parentNode.parentNode.children[2].innerText.replaceAll(',', '');
            var rows = gioHang.children;
            var rowDaCo = false;

            // Kiểm tra sản phẩm đã có trong giỏ hay chưa
            for (let i = 0; i < rows.length; i++) {
                if (rows[i].children[1].innerText === tenSP) {
                    rows[i].children[3].innerText = Number(rows[i].children[3].innerText) + 1; // Tăng số lượng
                    rowDaCo = true;
                    break;
                }
            }

            // Nếu chưa có, thêm vào giỏ hàng
            if (!rowDaCo) {
                var row = document.createElement("tr");
                row.innerHTML = `
                    <td class="stt"></td>
                    <td>${tenSP}</td>
                    <td class="dongia">${giaSP}</td>
                    <td>1</td>
                    <td><button onclick="xoa(this)">-</button></td>
                `;
                gioHang.appendChild(row);
            }

            chinhSuaGioHang();
        }

        function chinhSuaGioHang() {
            var tong = 0;
            var rows = gioHang.children;

            for (let i = 0; i < rows.length; i++) {
                rows[i].getElementsByClassName("stt")[0].innerHTML = i + 1; // Số thứ tự
                tong += Number(rows[i].getElementsByClassName("dongia")[0].innerText.replaceAll(",", "")) * Number(rows[i].children[3].innerText);
            }

            tongSoTien.innerHTML = "Tổng tiền là : " + tong.toLocaleString() + " VNĐ";
            if (rows.length === 0) {
                tongSoTien.style.display = "none";
                thanhToan.style.display = "none";
            } else {
                tongSoTien.style.display = "block";
                thanhToan.style.display = "block";
            }
        }

        function xoa(obj) {
            var row = obj.parentNode.parentNode;
            var soLuong = row.children[3].innerText;

            // Giảm số lượng, nếu số lượng còn 0 thì xóa sản phẩm
            if (soLuong > 1) {
                row.children[3].innerText = Number(soLuong) - 1;
            } else {
                gioHang.removeChild(row);
            }

            chinhSuaGioHang();
        }

        
    </script>
</body>
</html>